import React, { useEffect } from 'react';
import L from 'leaflet';
import 'leaflet/dist/leaflet.css';
import logo from './Icon.svg';
import stops from './stops.json';

const Map = () => {

    const LogoHandicap =    <svg width="635" height="425" viewBox="0 0 635 425" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M562.281 0.82622C552.27 1.94095 545.673 3.82445 538.923 7.47615C523.415 15.9327 513.026 29.9629 509.12 47.7601C508.438 50.9505 508.286 52.7572 508.286 59.4071C508.286 66.7105 508.362 67.633 509.348 71.8613C510.713 77.7424 512.116 81.6632 514.77 86.6987C522.77 102.074 536.876 112.952 553.749 116.719C558.792 117.873 569.106 118.142 574.566 117.258C592.16 114.49 607.933 103.343 616.427 87.7365C628.75 65.0576 624.882 36.5359 607.023 18.3159C598.151 9.28277 587.534 3.6707 575.362 1.595C571.836 0.979976 564.594 0.557148 562.281 0.82622Z" fill="#0066FF"/>
                            <path d="M412.885 27.0027C404.126 28.3865 397.149 31.0773 390.438 35.6515C388.618 36.8815 369.052 53.7178 345.013 74.7438C338.301 80.625 333.941 84.4304 325.409 91.8491C320.252 96.308 318.47 98.1531 316.992 100.344C313.882 105.072 312.707 109.07 312.745 114.759C312.783 121.639 314.944 126.944 319.797 131.902C324.916 137.169 330.111 139.398 337.24 139.398C344.141 139.398 348.349 137.63 355.819 131.633C369.432 120.678 401.32 95.1164 403.975 93.0023C409.283 88.8509 412.999 87.4287 418.573 87.4287C422.289 87.4287 424.64 87.8899 427.863 89.389C430.631 90.6575 444.66 101.228 446.935 103.765C451.372 108.685 452.357 116.45 449.324 122.6C448.641 123.946 446.025 127.52 443.181 130.903C438.631 136.361 420.848 157.772 407.766 173.532C404.847 177.068 400.752 182.027 398.628 184.564C393.471 190.752 391.575 193.482 389.376 197.825C385.243 205.974 383.878 212.317 384.182 222.195C384.333 227.654 384.523 229.383 385.395 232.766C389.718 249.641 401.472 262.864 417.132 268.437C424.753 271.167 418.876 270.974 490.995 271.205L556.024 271.397L558.034 272.32C561.977 274.126 564.404 278.316 564.101 282.698C563.949 285.081 567.286 278.47 526.752 356.539C517.576 374.183 509.651 389.827 509.158 391.326C508.4 393.594 508.248 394.748 508.248 398.822C508.248 403.089 508.362 403.973 509.31 406.779C511.964 414.62 517.917 420.54 525.88 423.269C527.548 423.846 529.065 424 533.274 424C539.34 423.961 541.502 423.423 546.128 420.655C549.957 418.349 552.422 415.581 558.147 407.086C606.151 335.513 626.437 305.146 627.764 302.763C630.001 298.766 632.314 292.692 633.49 287.58C634.362 283.736 634.476 282.544 634.514 275.625C634.514 267.207 634.172 264.67 631.973 257.751C629.281 249.064 625.072 242.184 618.436 235.418C608.73 225.578 597.203 220.389 582.794 219.312C580.178 219.12 561.788 218.928 541.919 218.928H505.859L504.229 217.66C501.233 215.353 500.285 211.509 501.916 208.319C502.371 207.512 510.561 198.555 520.116 188.446C538.392 169.188 540.857 166.267 544.459 159.271C546.696 154.966 549.085 147.855 549.957 142.973C550.678 138.975 551.095 129.135 550.64 126.713L550.336 125.022L546.924 123.984C535.966 120.601 527.055 115.182 518.865 106.879C513.518 101.459 510.144 96.8077 506.769 90.1578C503.774 84.2767 501.878 78.8183 500.626 72.5144C500.096 69.8621 499.565 67.5558 499.413 67.4404C499.261 67.3251 496.493 65.5954 493.27 63.635C490.047 61.6746 485.535 58.907 483.222 57.4848C459.486 42.7627 444.243 33.4989 440.944 31.846C433.967 28.3481 426.611 26.6952 418.611 26.7721C415.994 26.8105 413.416 26.9259 412.885 27.0027Z" fill="#0066FF"/>
                            <path d="M395.822 146.701C369.545 148.316 343.42 158.156 322.073 174.454C313.693 180.874 304.858 189.522 298.109 197.979L295.644 201.054L268.078 201.246L240.55 201.438L238.464 202.438C234.255 204.475 232.018 207.742 231.715 212.24C231.412 217.16 233.611 221.196 237.858 223.464L239.791 224.502L260.381 224.617C271.68 224.655 280.932 224.848 280.932 225.001C280.932 225.155 279.984 227.5 278.847 230.229C277.671 232.92 275.965 237.456 274.979 240.3L273.273 245.451L228.264 245.528L183.294 245.643L181.36 246.681C179.085 247.873 176.848 250.294 175.862 252.562C175.028 254.484 174.839 258.289 175.483 260.711C176.393 264.171 180.185 267.669 183.863 268.476C185.19 268.783 198.84 268.899 227.165 268.899H268.533L268.23 271.282C268.078 272.627 267.85 277.24 267.699 281.583L267.471 289.463L253.631 289.656C240.095 289.848 239.754 289.886 238.009 290.732C235.696 291.885 233.004 294.922 232.246 297.228C230.312 302.917 232.966 309.298 238.275 311.796C240.171 312.719 240.246 312.719 255.072 312.719H269.936L270.277 313.565C270.467 314.064 271.187 316.755 271.832 319.561C272.514 322.406 273.614 326.442 274.334 328.594C275.055 330.708 275.624 332.707 275.624 332.976C275.624 333.361 268.343 333.476 238.957 333.553L202.253 333.668L200.471 334.514C198.31 335.552 195.693 338.089 194.67 340.203C194.063 341.394 193.911 342.509 193.911 345.392C193.911 348.659 194.025 349.236 194.935 350.773C196.186 352.964 197.968 354.694 200.168 355.847L201.874 356.731L244.455 356.847L287.037 356.924L289.16 360.306C291.739 364.419 297.047 371.684 299.777 374.836C300.877 376.143 301.787 377.296 301.787 377.45C301.787 377.565 281.69 377.681 257.12 377.681C206.5 377.681 210.064 377.45 206.5 380.756C203.808 383.254 202.67 385.753 202.67 389.404C202.67 391.596 202.86 392.518 203.694 394.286C204.907 396.785 207.069 398.937 209.609 400.129L211.353 400.936L270.126 401.128L328.898 401.321L334.206 404.549C350.738 414.62 368.901 420.924 388.997 423.5C394.268 424.153 415.577 424.192 420.279 423.5C434.536 421.501 443.75 419.118 455.353 414.505C492.588 399.629 522.24 367.763 534.79 329.055C535.89 325.673 537.065 321.598 537.407 320.022C537.748 318.446 538.203 316.601 538.392 315.986C538.923 314.141 540.592 304.032 541.047 299.65C541.274 297.42 541.502 292.654 541.54 289.079L541.615 282.544H520.95H500.285L500.058 289.079C499.489 304.032 496.19 316.832 489.517 329.824C476.701 354.809 454.367 372.684 427.635 379.372C420.62 381.14 415.729 381.832 408.335 382.14C373.868 383.6 340.956 365.649 322.907 335.59C308.119 310.874 305.048 280.93 314.489 253.139C316.385 247.527 321.238 237.686 324.803 232.189C328.367 226.693 334.358 219.351 338.453 215.469C349.677 204.783 362.948 196.903 376.939 192.597C380.238 191.598 380.238 191.598 381.452 189.484C383.272 186.255 386.305 182.296 394.647 172.225C412.43 150.814 415.16 147.509 415.16 147.163C415.16 146.932 412.847 146.663 409.966 146.548C404.164 146.24 403.065 146.279 395.822 146.701Z" fill="#0066FF"/>
                            <path d="M97.5625 201.592C92.1023 202.976 88.5381 207.474 88.5381 212.97C88.5381 217.621 90.9269 221.542 94.9841 223.579C96.842 224.502 96.9179 224.502 109.355 224.502C121.602 224.502 121.906 224.502 123.46 223.618C125.963 222.272 127.631 220.581 128.769 218.236C129.679 216.391 129.83 215.584 129.83 212.97C129.83 210.395 129.641 209.588 128.807 207.973C127.517 205.513 125.394 203.437 123.005 202.323C121.185 201.477 120.73 201.439 109.924 201.362C103.781 201.323 98.2071 201.439 97.5625 201.592Z" fill="#0066FF"/>
                            <path d="M151.519 201.669C149.358 202.169 147.424 203.322 145.907 204.975C140.523 210.702 141.85 219.543 148.637 223.348L150.685 224.502L180.109 224.617C208.813 224.694 209.609 224.694 211.581 223.925C217.723 221.619 220.719 214.008 217.875 208.05C216.624 205.513 214.121 203.13 211.619 202.13C209.95 201.477 207.903 201.438 181.398 201.361C165.549 201.323 152.315 201.477 151.519 201.669Z" fill="#0066FF"/>
                            <path d="M65.674 246.181C63.1335 247.065 61.1997 248.564 59.8347 250.794C58.318 253.177 57.863 255.137 58.0525 258.174C58.3559 262.479 60.6309 265.785 64.8019 267.86L66.5082 268.706H110.113H153.719L155.615 267.822C158.041 266.669 160.885 263.632 161.643 261.326C162.44 259.019 162.402 255.291 161.606 252.946C160.733 250.294 157.776 247.334 154.932 246.258C152.733 245.451 152.657 245.451 110.189 245.451C70.3378 245.489 67.5319 245.527 65.674 246.181Z" fill="#0066FF"/>
                            <path d="M7.28076 290.578C-0.75777 294.384 -1.8953 305.377 5.23321 310.643C8.00119 312.642 8.91122 312.757 20.8173 312.642C30.3726 312.527 31.7755 312.45 32.8751 311.835C34.9606 310.682 37.1219 308.452 38.1836 306.415C39.0557 304.724 39.2074 303.955 39.2074 301.187C39.2074 298.266 39.0936 297.689 38.0698 295.844C37.4632 294.729 36.2119 293.153 35.3019 292.346C32.496 289.809 31.5101 289.656 19.7177 289.656C9.47998 289.656 9.21456 289.694 7.28076 290.578Z" fill="#0066FF"/>
                            <path d="M58.5454 290.732C54.3365 292.769 52.0994 296.382 52.0994 301.187C52.0994 305.8 53.9952 309.105 57.9766 311.489L59.6829 312.527L93.5812 312.642L127.442 312.719L129.413 311.835C132.219 310.489 133.622 309.144 134.987 306.376C137.793 300.611 135.594 293.807 129.906 290.732L128.314 289.848L94.5671 289.732L60.8204 289.655L58.5454 290.732Z" fill="#0066FF"/>
                            <path d="M156.487 290.194C153.491 291.308 150.382 294.422 149.396 297.305C148.865 298.958 148.865 303.186 149.396 305.031C150.154 307.53 152.354 310.066 155.008 311.489L157.434 312.719L184.204 312.642L210.974 312.527L212.68 311.642C215.069 310.374 216.586 308.798 217.837 306.261C218.709 304.531 218.899 303.609 218.937 301.379C218.937 299.073 218.747 298.304 217.686 296.113C216.434 293.538 214.993 292.039 212.301 290.578C211.05 289.886 209.647 289.848 184.432 289.771C163.198 289.694 157.624 289.771 156.487 290.194Z" fill="#0066FF"/>
                            <path d="M54.9432 333.822C51.4168 334.552 48.6109 336.82 46.9425 340.203C45.8429 342.509 45.7671 342.893 45.9188 345.892C46.0325 348.467 46.26 349.466 47.0563 350.812C48.3076 352.964 50.1276 354.694 52.2889 355.847L53.9952 356.731H72.3852C90.7374 356.731 90.7753 356.731 92.3678 355.847C94.8704 354.502 96.5388 352.811 97.6763 350.466C98.5863 348.621 98.738 347.814 98.7001 345.2C98.7001 342.663 98.5105 341.779 97.7142 340.203C96.425 337.743 94.3016 335.667 91.9128 334.552C90.0169 333.668 89.8653 333.668 73.1436 333.591C63.8538 333.553 55.6636 333.668 54.9432 333.822Z" fill="#0066FF"/>
                            <path d="M120.427 333.899C115.27 335.167 111.44 340.049 111.44 345.43C111.44 349.466 114.133 353.772 117.924 355.847L119.593 356.731H146.135H172.677L174.497 355.77C176.735 354.617 179.123 352.08 180.147 349.774C181.095 347.583 181.133 343.854 180.261 341.202C179.465 338.742 176.735 335.744 174.194 334.552L172.298 333.668L147.083 333.591C133.053 333.553 121.223 333.707 120.427 333.899Z" fill="#0066FF"/>
                            <path d="M100.558 378.372C98.0176 379.295 96.0838 380.832 94.7188 383.024C90.927 389.02 93.1641 396.785 99.6101 400.014L101.392 400.936H141.395H181.398L183.598 399.821C187.427 397.861 189.551 394.594 189.854 390.327C190.195 385.368 188.072 381.409 183.825 379.026L181.778 377.873L142.154 377.796C104.881 377.719 102.416 377.757 100.558 378.372Z" fill="#0066FF"/>
                        </svg>

  useEffect(() => {
    // création de la carte
    const mymap = L.map('mapid').setView([47.21010098, -1.65221959], 10);

    

    // ajout de la couche de tuiles OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
      maxZoom: 18,
    }).addTo(mymap);

    // création de l'icône personnalisée
    const myIcon = L.icon({
        iconUrl: logo,
        iconSize: [24, 24],
        iconAnchor: [16, 16],
    });

    stops.forEach((stop) => {
        const marker = L.marker([stop.stop_lat, stop.stop_lon], {icon: myIcon}).addTo(mymap);

        const tooltipContent = document.createElement('div');
        tooltipContent.innerHTML = `
          <div>
            <h3>${stop.stop_name}</h3>
            <p>
                ${
                    stop.wheelchair_boarding === "" 
                        ?   '0 places handicapé disponible'
                        :   stop.wheelchair_boarding === "1" 
                                ?   '1 place handicapé disponible'
                                :   '2 places handicapé disponible'
                }
            </p>
          </div>
        `;

        const tooltip = L.tooltip({
            permanent: false,
            direction: 'top',
            opacity: 0.8,
            offset: [0, -20]
        }).setContent(tooltipContent);
        marker.bindTooltip(tooltip);
    });

    // nettoyage de la carte lors de la destruction du composant
    return () => {
      mymap.remove();
    };
  }, []);

  return <div id="mapid" style={{ height: '100vh' }} />;
};

export default Map;
